(function(b,g){typeof exports=="object"&&typeof module<"u"?module.exports=g(require("bootstrap")):typeof define=="function"&&define.amd?define(["bootstrap"],g):(b=typeof globalThis<"u"?globalThis:b||self,b.combo=g(b.bootstrap))})(this,function(b){"use strict";var tt=Object.defineProperty;var et=(b,g,$)=>g in b?tt(b,g,{enumerable:!0,configurable:!0,writable:!0,value:$}):b[g]=$;var i=(b,g,$)=>(et(b,typeof g!="symbol"?g+"":g,$),$);class g{static toBoolean(t){return typeof t=="boolean"?t:t==="true"}}let $;class C{static getLogger(){return $===void 0&&($=new C),$}error(t){if(console.error(t),process.env.NODE_ENV!=="production")throw new Error(t)}}let j=p=>crypto.getRandomValues(new Uint8Array(p)),J=(p,t,e)=>{let s=(2<<Math.log(p.length-1)/Math.LN2)-1,l=-~(1.6*s*t/p.length);return()=>{let o="";for(;;){let h=e(l),a=l;for(;a--;)if(o+=p[h[a]&s]||"",o.length===t)return o}}},q=(p,t)=>J(p,t,j);class E{static toHtmlId(t){return t.toString().replace(/[_.\s:\/\\]/g,"-")}static createRandomId(){return q("abcdefghijklmnopqrstuvwxyz",10)()}static toEntities(t){let e=[];for(let s=0;s<t.length;s++){let l=`&#${t.charCodeAt(s)};`;e.push(l)}return e.join("")}}class G{static isString(t){return typeof t=="string"||t instanceof String}}const w=class{constructor(t){i(this,"tab","unknown");i(this,"mutable",!0);i(this,"values",[]);i(this,"defaultValues",[]);i(this,"multiple",!1);i(this,"children",{});i(this,"name");i(this,"type");i(this,"label");i(this,"url");i(this,"description");i(this,"parent");i(this,"domainValues");i(this,"width");this.name=t}getLabelAnchor(){if(this.getUrl()===void 0&&this.getDescription()===void 0)return this.getLabel();let t=this.getUrl();return this.getUrl()===void 0?(t="#",`
<span class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" title="${this.getDescription()}">
    <a href="${t}" title="${this.getDescription()}" style="text-decoration:none;pointer-events: none;">${this.getLabel()}</a>
</span>`):`<a href="${t}" title="${this.getDescription()}" data-bs-toggle="tooltip" style="text-decoration:none" target="_blank">${this.getLabel()}</a>`}setType(t){return this.type=t,this}setLabel(t){return this.label=t,this}setUrl(t){return this.url=t,this}addValue(t,e){return this.values.push(t),this.defaultValues.push(e),this}getType(){return this.type}getLabel(){return this.label===void 0?this.getName().split(/[_\-]/).map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "):this.label}getUrl(){return this.url}getName(){return this.name}getDescription(){return this.description}getTab(){return this.tab}static createFromJson(t,e=null){t.hasOwnProperty("name")||C.getLogger().error("To create a form meta field, the name property is mandatory.");let s=t.name,l=w.createFromName(s);e!=null&&l.setParent(e);let o,h;for(let a in t){if(!t.hasOwnProperty(a))continue;let r=t[a];switch(a){case"name":continue;case"label":l.setLabel(r);continue;case"tab":l.setTab(r);continue;case"type":l.setType(r);continue;case"mutable":l.setMutable(r);continue;case"description":l.setDescription(r);continue;case"url":l.setUrl(r);continue;case"value":o=r;continue;case"default":h=r;continue;case"domain-values":l.setDomainValues(r);continue;case"multiple":l.setMultiple(r);continue;case"width":l.setControlWidth(r);continue;case"children":let u=r;for(let m in u){if(!u.hasOwnProperty(m))continue;let n=w.createFromJson(u[m],l);l.addChild(n)}continue;default:C.getLogger().error(`The property (${a}) of the form (${s}) is unknown`)}}return Array.isArray(o)?o.forEach((a,r)=>{let u=h[r];u!==void 0?l.addValue(a,u):l.addValue(a,"")}):l.addValue(o,h),l}setMultiple(t){return this.multiple=t,this}setParent(t){return this.parent=t,this}static createFromName(t){return new w(t)}isMutable(){return this.mutable}setTab(t){return this.tab=t,this}setMutable(t){return this.mutable=g.toBoolean(t),this}setDescription(t){return this.description=t,this}getDefaultValue(){return this.defaultValues[0]}getValue(){return this.values[0]}getDomainValues(){return this.domainValues}setDomainValues(t){if(!Array.isArray(t)){console.error(`The domains values should be an array. (${t}) is not an array`);return}return this.domainValues=t,this}setControlWidth(t){return this.width=t,this}getControlWidth(){return this.width===void 0&&this.parent!==void 0?12/this.parent.getChildren().length:this.width}getValues(){return this.values}getDefaultValues(){return this.defaultValues}getChildren(){return Object.values(this.children)}addChild(t){return this.children[t.getName()]=t,this}toHtmlLabel(t,e){let s=this.getLabelAnchor(),l;return this.getType()===w.BOOLEAN?l="form-check-label":l="col-form-label",typeof e<"u"&&(l=`${e} ${l}`),`<label for="${t}" class="${l}">${s}</label>`}toHtmlControl(t,e=null,s=null){let l=this.getType(),o=this.isMutable(),h=this.getDomainValues(),a,r;if(h!==void 0){r="select";let u="";s!==void 0&&(u=` (${s})`);let m="";this.getMultiple()&&(m="multiple"),r=`<select class="form-select" aria-label="${this.getLabel()}" name="${this.getName()}" id="${t}" ${m}>`;let n="";e===null&&(n="selected"),r+=`<option value="" ${n}>Default${u}</option>`;for(let d of h)d===e?n="selected":n="",r+=`<option value="${d}" ${n}>${d}</option>`;return r+="</select>",r}else{let u="No value";o&&(u=`Enter a ${this.getLabel()}`),s!=null&&(G.isString(s)?u=E.toEntities(s):u=s);let m=`placeholder="${u}"`,n="",d,B=this.getName();o!==void 0&&!o?a="disabled":a="";let S="input",L="form-control",c="",I=3;switch(l){case w.DATE_TIME:d="datetime-local",e!==null?(e=e.slice(0,19),n=`value="${e}"`):!o&&s!==null&&(s=s.slice(0,19),n=`value="${s}"`),m="";break;case w.PARAGRAPH:S="textarea",e!==null&&(e=E.toEntities(e),n=`${e}`);break;case w.JSON:S="textarea",e!==null&&(typeof e=="object"&&(e=JSON.stringify(e,null,2)),e=E.toEntities(e),n=`${e}`),I=15;break;case w.BOOLEAN:d="checkbox",L="form-check-input",s!==null?(n=`value="${s}"`,e===s&&(c="checked")):e==="on"&&(c="checked"),m="";break;default:d="text",e!=null&&(n=`value="${e}"`)}switch(S){case"textarea":r=`<textarea id="${t}" name="${B}" class="${L}" rows="${I}" ${m} ${a}>${n}</textarea>`;break;default:case"input":r=`<input type="${d}" name="${B}" class="${L}" id="${t}" ${m} ${n} ${c} ${a}/>`;break}return r}}toJavascriptObject(){return{name:this.getName(),label:this.getLabel(),type:this.getType(),description:this.getDescription(),tab:this.getTab(),mutable:this.isMutable(),value:this.getValue(),default:this.getDefaultValue(),url:this.getUrl()}}getMultiple(){return this.multiple}};let T=w;i(T,"TABULAR_TYPE","tabular"),i(T,"DATE_TIME","datetime"),i(T,"PARAGRAPH","paragraph"),i(T,"BOOLEAN","boolean"),i(T,"JSON","json");class N{constructor(t){i(this,"name");i(this,"width");i(this,"label");i(this,"widthField");i(this,"widthLabel");this.name=t}getName(){return this.name}setWidth(t){return this.width=t,this}getWidth(){return this.width}static createFromJson(t){t.hasOwnProperty("name")||C.getLogger().error("A name property is mandatory to create a tab and was not found in the json provided");let e=t.name,s=new N(e);for(let l in t){if(!t.hasOwnProperty(l))continue;let o=t[l];switch(l){case"name":continue;case"label":s.setLabel(o);continue;case"width-field":s.setWidthField(o);continue;case"width-label":s.setWidthLabel(o);continue;default:C.getLogger().error(`The property (${l}) of the tab (${e}) is unknown`)}}return s}setLabel(t){return this.label=t,this}getLabel(){return this.label===void 0?this.name:this.label}setWidthField(t){return this.widthField=t,this}setWidthLabel(t){return this.widthLabel=t,this}getLabelWidth(){return this.widthLabel===void 0?3:this.widthLabel}getFieldWidth(){return this.widthField===void 0?12-this.getLabelWidth():this.widthField}static createFromName(t){return new N(t)}}class k{constructor(t){i(this,"formFields",{});i(this,"tabs",{});i(this,"width",8);i(this,"name");i(this,"label");i(this,"url");i(this,"getTabPaneId");i(this,"getTabNavId");i(this,"getControlId");if(t==null)throw new Error("The if of the form should not be null");this.name=t,this.getControlId=function(e){let s=E.toHtmlId(e);return`${t}-control-${s}`},this.getTabNavId=function(e){let s=E.toHtmlId(e.getName());return`${t}-tab-nav-${s}`},this.getTabPaneId=function(e){let s=E.toHtmlId(e.getName());return`${t}-tab-pane-${s}`}}getLabel(){return this.label}getUrl(){return this.url}getId(){return this.name}getControlWidth(){return this.width}getLabelWidth(){return 12-this.getControlWidth()}static createFromJson(t,e){let s=k.createFromId(t);for(let l in e){if(!e.hasOwnProperty(l))continue;let o=e[l];switch(l){case"fields":let h=o;for(let r in h)h.hasOwnProperty(r)&&s.addFormField(T.createFromJson(h[r]));continue;case"tabs":let a=o;for(let r in a)a.hasOwnProperty(r)&&s.addTab(N.createFromJson(a[r]));break;case"width":s.setControlWidth(o);break;case"label":s.setLabel(o);break;case"url":s.setUrl(o);break;default:C.getLogger().error(`The form property (${l}) is unknown`)}}return s}static createFromId(t){return new k(t)}addFormField(t){return this.formFields[t.getName()]=t,this.tabs.hasOwnProperty(t.getTab())||(this.tabs[t.getTab()]=N.createFromName(t.getTab())),this}getFields(){return Object.values(this.formFields)}getTabs(){return Object.values(this.tabs)}addTab(t){this.tabs[t.getName()]=t}valueOf(){return this.getId()}getFieldsForTab(t){return this.getFields().filter(e=>e.getTab()===t)}toHtmlElement(){let t=this.getId(),e='<ul class="nav nav-tabs mb-3">',s,l,o=this.getTabs(),h=o[0];for(let d of o){Object.is(d,h)?(s="active",l="true"):(s="",l="false");let B=d.getLabel(),S=this.getTabPaneId(d),L=this.getTabNavId(d);e+=`
<li class="nav-item">
<button
    class="nav-link ${s}"
    id="${L}"
    type="button"
    role="tab"
    aria-selected = "${l}"
    aria-controls = "${S}"
    data-bs-toggle = "tab"
    data-bs-target = "#${S}" >${B}
    </button>
</li>`}e+="</ul>";let a='<div class="tab-content">',r,u,m=0;for(let d of o){let B=this.getTabPaneId(d),S=this.getTabNavId(d);d===h?s="active":s="",a+=`<div class="tab-pane ${s}" id="${B}" role="tabpanel" aria-labelledby="${S}">`,u=d.getLabelWidth(),r=d.getFieldWidth();let L=this.getFieldsForTab(d.getName());if(L.length===1){let c=L[0];if(c.getChildren().length===0){m++;let I=this.getControlId(m),F=c.toHtmlLabel(I),x=c.getValue(),V=c.getDefaultValue(),W=c.toHtmlControl(I,x,V);a+=`
<div class="row mb-3 text-center"><div class="col-sm-12">${F}</div></div>
<div class="row mb-3"><div class="col-sm-12">${W}</div></div>
`,a+="</div>";continue}}for(let c of L)switch(c.getChildren().length){case 0:m++;let F=this.getControlId(m),x=c.toHtmlLabel(F,`col-sm-${u}`),V=c.getValue(),W=c.getDefaultValue(),K=c.toHtmlControl(F,V,W);a+=`
<div class="row mb-3">
    ${x}
    <div class="col-sm-${r}">${K}</div>
</div>
`;break;default:let Y=c.getLabelAnchor();a+=`<div class="row mb-3 text-center">${Y}</div>`,a+='<div class="row mb-3">';let U=0;for(const A of c.getChildren()){let O=A.getControlWidth();a+=`<div class="col-sm-${O} text-center">`,a+=A.getLabelAnchor(),a+="</div>";let P=A.getValues().length;P>U&&(U=P)}a+="</div>";for(let A=0;A<U;A++){a+='<div class="row mb-3">';for(const O of c.getChildren()){let P=O.getValues()[A],Q=O.getDefaultValues()[A];m++;let Z=this.getControlId(m),_=O.getControlWidth();a+=`<div class="col-sm-${_}">`,a+=O.toHtmlControl(Z,P,Q),a+="</div>"}a+="</div>"}break}a+="</div>"}a+="</div>";let n=document.createElement("form");return n.setAttribute("id",t),n.innerHTML=`${e} ${a}`,n}setControlWidth(t){return this.width=t,this}setLabel(t){this.label=t}setUrl(t){this.url=t}}let H={};const R=class{constructor(t){i(this,"footerButtons",[]);i(this,"bodies",[]);i(this,"isBuild",!1);i(this,"bodyStyles",{});i(this,"dialogStyles",{});i(this,"showFooter",!0);i(this,"dialogClasses",[]);i(this,"modalId");i(this,"modalRootHtmlElement");i(this,"headerText");i(this,"isResetOnClose");i(this,"closeButton");i(this,"isCentered");i(this,"callBack");i(this,"bootStrapModal",null);i(this,"modalContent");i(this,"modalBody");this.modalId=t;let e=document.getElementById(t);e!==null?(C.getLogger().error(`The id (${t}) given to create a modal was already used by an element in the DOM. We have reused it.`),this.modalRootHtmlElement=e,this.reset()):(this.modalRootHtmlElement=document.createElement("div"),this.modalRootHtmlElement.setAttribute("id",this.modalId),this.modalRootHtmlElement.classList.add("modal","fade"),this.modalRootHtmlElement.setAttribute("aria-hidden","true"))}setHeader(t){return this.headerText=t,this}addBody(t){return this.bodies.push(t),this}addBodyStyle(t,e){return this.bodyStyles[t]=e,this}noFooter(){return this.showFooter=!1,this}addDialogStyle(t,e){return this.dialogStyles[t]=e,this}addDialogClass(t){return this.dialogClasses.push(t),this}resetOnClose(){return this.isResetOnClose=!0,this}addFooterButton(t){return this.footerButtons.push(t),this}addFooterCloseButton(t="Close"){this.closeButton=document.createElement("button"),this.closeButton.classList.add("btn","btn-secondary"),this.closeButton.innerHTML=t;let e=this;return this.closeButton.addEventListener("click",function(){e.bootStrapModal.hide()}),this.addFooterButton(this.closeButton),this}centered(){return this.isCentered=!0,this}show(){if(this.modalRootHtmlElement==null)throw new Error("This modal has no HTML element, you can't use it anymore");if(this.isBuild||this.build(),this.isResetOnClose===!0){let t=this;this.getElement().addEventListener("hidden.bs.modal",function(){t.reset()})}if(this.callBack!==void 0&&this.closeButton!==void 0){let t=this;this.closeButton.addEventListener("click",function(){t.dismissHide(),t.callBack()})}this.bootStrapModal.show()}dismissHide(){this.bootStrapModal!==null&&this.bootStrapModal.hide()}getModalId(){return this.modalId}setCallBackOnClose(t){return this.callBack=t,this}static createFromId(t){let e=new R(t);return H[t]=e,e}static createTemporary(){return this.createFromId(E.createRandomId())}getElement(){return this.modalRootHtmlElement}wasBuild(){return this.isBuild}setCentered(t){return this.isCentered=t,this}resetIfBuild(){return this.wasBuild()&&this.reset(),this}reset(){this.modalRootHtmlElement.querySelectorAll('[data-bs-toggle="tab"]').forEach(t=>{let e=b.Tab.getInstance(t);e!==null&&e.dispose()}),this.bootStrapModal!==void 0&&this.dismissHide(),this.modalRootHtmlElement.innerHTML="",this.isBuild=!1,this.bodies=[],this.footerButtons=[],this.headerText=void 0}build(){this.isBuild=!0,document.body.appendChild(this.modalRootHtmlElement);const t=document.createElement("div");t.classList.add("modal-dialog","modal-dialog-scrollable","modal-lg"),this.isCentered?t.classList.add("modal-dialog-centered"):(t.style.setProperty("margin","5rem auto"),t.style.setProperty("height","calc(100% - 9rem)"));for(let s in this.dialogStyles)this.dialogStyles.hasOwnProperty(s)&&t.style.setProperty(s,this.dialogStyles[s]);for(let s in this.dialogClasses)t.classList.add(s);this.modalRootHtmlElement.appendChild(t),this.modalContent=document.createElement("div"),this.modalContent.classList.add("modal-content"),t.appendChild(this.modalContent),this.modalBody=document.createElement("div"),this.modalBody.classList.add("modal-body");for(let s in this.bodyStyles)this.bodyStyles.hasOwnProperty(s)&&this.modalBody.style.setProperty(s,this.bodyStyles[s]);if(this.modalContent.appendChild(this.modalBody),this.bootStrapModal=b.Modal.getInstance(this.modalRootHtmlElement),this.bootStrapModal===null){let s={backdrop:!0,keyboard:!0,focus:!0};this.bootStrapModal=new b.Modal(this.modalRootHtmlElement,s)}if(this.headerText!==void 0){let s=`
<div class="modal-header">
    <h5 class="modal-title">${this.headerText}</h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
`;this.modalContent.insertAdjacentHTML("afterbegin",s)}for(let s of this.bodies)switch(typeof s){case"string":this.modalBody.insertAdjacentHTML("beforeend",s);break;default:case"object":this.modalBody.appendChild(s);break}if(this.showFooter){let s=document.createElement("div");s.classList.add("modal-footer"),this.modalContent.appendChild(s),this.footerButtons.length===0&&this.addFooterCloseButton();for(let l of this.footerButtons)typeof l=="string"?s.insertAdjacentHTML("beforeend",l):s.appendChild(l)}let e=`#${this.modalId} [data-bs-toggle="tooltip"]`;document.querySelectorAll(e).forEach(s=>new b.Tooltip(s))}static getOrCreate(t){let e=R.getModal(t);return e===null&&(e=R.createFromId(t)),e}};let v=R;i(v,"getModal",function(t){return t in H?H[t]:null}),i(v,"listModals",function(){console.log(Object.keys(H).join(", "))}),i(v,"resetAllModals",function(){for(let t in H)H.hasOwnProperty(t)&&H[t].reset()});class X{static hasWindowGuard(t){if(!this.hasWindow(t))throw Error("The element has no window")}static hasWindow(t){return!(!t||!t.ownerDocument||!t.ownerDocument.defaultView)}static getWindow(t){return this.hasWindowGuard(t),t.ownerDocument.defaultView}static formDataToObject(t){let e={};for(let s of t){let l=s[0],o=s[1];if(e.hasOwnProperty(l)){let h=e[l];Array.isArray(h)?e[l].push(o):e[l]=[h,o]}else e[l]=o}return e}}class z{constructor(t){i(this,"method","GET");i(this,"url");this.url=t}async getJson(){let t=await this.getResponse();return t.status!==200?{}:t.json()}async getText(){let t=await this.getResponse();return t.status!==200?"":t.text()}setMethod(t){return this.method=t.toUpperCase(),this}sendFormDataAsJson(t){return fetch(this.url.toString(),{method:this.method,body:JSON.stringify(X.formDataToObject(t)),headers:{"Content-Type":"application/json"}})}async getResponse(){let t=await fetch(this.url.toString(),{method:this.method});if(t.status!==200){let e=v.createTemporary();e.addBody(`Bad request:  the call ${this.url} to the backend sends back the following exit code`+t.status),e.show()}return t}}const f=class{constructor(t){i(this,"url");let e=window.DOKU_BASE,s=window.JSINFO;switch(t){case f.AJAX:this.url=new URL(e+"lib/exe/ajax.php",window.location.href),this.url.searchParams.set("id",s.id);break;case f.RUNNER:this.url=new URL(e+"lib/exe/taskrunner.php",window.location.href),this.url.searchParams.set("id",s.id);break;case f.FETCH:this.url=new URL(e+"lib/exe/fetch.php",window.location.href);break;case f.EDIT:this.url=new URL(e+"doku.php",window.location.href),this.url.searchParams.set("do","edit"),this.url.searchParams.set("id",s.id);break;case f.SHOW:this.url=new URL(e+"doku.php",window.location.href),this.url.searchParams.set("id",s.id);break;default:throw new Error(`The type ${t} is unknown`)}}setProperty(t,e){return this.url.searchParams.set(t,e),this}toString(){return this.url.toString()}getCall(){return this.url.searchParams.get(f.CALL)}toRequest(){return new z(this.url)}static createAjax(t){return new f(this.AJAX).setProperty(f.CALL,t)}static createRunner(){return new f(this.RUNNER)}static createFetch(t,e){let s=new f(this.FETCH);if(typeof t>"u")throw new Error("The media id is mandatory");return s.setProperty("media",t),typeof e<"u"&&s.setProperty("drive",e),s}static createEdit(t){let e=new f(this.EDIT);return typeof t<"u"&&e.setProperty("id",t),e}};let y=f;i(y,"AJAX","AJAX"),i(y,"RUNNER","RUNNER"),i(y,"CALL","call"),i(y,"EDIT","edit"),i(y,"SHOW","show"),i(y,"FETCH","fetch");class D{constructor(t){i(this,"date");this.date=t}static createFromIso(t){let e=new Date(t);return new D(e)}toSqlTimestampString(){return`${this.date.getFullYear()}-${(this.date.getMonth()+1).toString().padStart(2,"0")}-${this.date.getDate().toString().padStart(2,"0")} ${this.date.getHours().toString().padStart(2,"0")}:${this.date.getMinutes().toString().padStart(2,"0")}:${this.date.getSeconds().toString().padStart(2,"0")}`}}class M{static toHtmlId(t){return E.toHtmlId(t)}static getOrCreateModal(t){return v.getOrCreate(t)}static removeAllModals(){v.resetAllModals()}static createAjaxUrl(t){return y.createAjax(t)}static getRunnerUrl(){return y.createRunner()}static createFormMetaField(t){return T.createFromName(t)}static createFormFromJson(t,e){return k.createFromJson(t,e)}static createTemporaryModal(){return v.createTemporary()}}return i(M,"comboDate",D),i(M,"DokuUrl",y),M});
